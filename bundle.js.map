{"version":3,"names":[],"mappings":"","sources":["bundle.js"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.BaseController=void 0;var BaseController=/*#__PURE__*/function(){function BaseController(){_classCallCheck(this,BaseController)}_createClass(BaseController,[{key:\"init\",value:function init(main){}},{key:\"destroy\",value:function destroy(){}}]);return BaseController}();exports.BaseController=BaseController;\n\n},{}],2:[function(require,module,exports){\n\"use strict\";function _typeof(obj){\"@babel/helpers - typeof\";return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&\"function\"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function\")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,\"prototype\",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)===\"object\"||typeof call===\"function\")){return call}else if(call!==void 0){throw new TypeError(\"Derived constructors may only return object or undefined\")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")}return self}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}Object.defineProperty(exports,\"__esModule\",{value:true});exports.FrameController=void 0;var base_controller_1=require(\"./base-controller\");var FrameController=/*#__PURE__*/function(_base_controller_1$Ba){_inherits(FrameController,_base_controller_1$Ba);var _super=_createSuper(FrameController);function FrameController(){var _this;_classCallCheck(this,FrameController);_this=_super.call(this);_this.deltaTime=1;_this.fps=0;_this.frameCount=0;_this.frameTimer=0;_this.lastFrameTime=0;_this.frameStartTime=0;_this.targetFPS=60;_this.targetFrameTime=1000/_this.targetFPS;_this.deltaTime=_this.targetFrameTime/1000;_this.frameStartTime=performance.now();_this.lastFrameTime=_this.frameStartTime;return _this}_createClass(FrameController,[{key:\"startFrame\",value:function startFrame(){this.frameStartTime=performance.now();this.deltaTime=(this.frameStartTime-this.lastFrameTime)/1000;this.frameCount++;this.frameTimer+=this.deltaTime;if(this.frameTimer>=1){this.fps=this.frameCount;this.frameCount=0;this.frameTimer-=1}}},{key:\"endFrame\",value:function endFrame(callback){this.lastFrameTime=performance.now();var delay=this.calculateNextTimeDelay();setTimeout(callback,delay)}},{key:\"renderFPSCounter\",value:function renderFPSCounter(_ref){var context=_ref.context,width=_ref.width,height=_ref.height;var text=\"FPS: \"+this.fps;var size=12;context.save();context.textAlign=\"left\";context.textBaseline=\"middle\";context.fillStyle=\"#FFF\";context.font=\"\".concat(size,\"pt Bebas Neue\");context.shadowColor=\"#000\";context.shadowOffsetX=0;context.shadowOffsetY=size/7;context.shadowBlur=2;var metrics=context.measureText(text);var x=width-metrics.width;var y=height-size/2;context.fillText(text,x-size,y-size*1.5);context.restore()}},{key:\"calculateNextTimeDelay\",value:function calculateNextTimeDelay(){var elapsed=Math.abs(this.lastFrameTime-this.frameStartTime);return Math.floor(Math.clamp(this.targetFrameTime-elapsed,0,this.targetFrameTime))}}]);return FrameController}(base_controller_1.BaseController);exports.FrameController=FrameController;\n\n},{\"./base-controller\":1}],3:[function(require,module,exports){\n\"use strict\";function _typeof(obj){\"@babel/helpers - typeof\";return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&\"function\"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function\")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,\"prototype\",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)===\"object\"||typeof call===\"function\")){return call}else if(call!==void 0){throw new TypeError(\"Derived constructors may only return object or undefined\")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")}return self}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}Object.defineProperty(exports,\"__esModule\",{value:true});exports.MapController=void 0;var vector2_1=require(\"./../model/vector2\");var base_controller_1=require(\"./base-controller\");var blocks_1=require(\"../enum/blocks\");var MapController=/*#__PURE__*/function(_base_controller_1$Ba){_inherits(MapController,_base_controller_1$Ba);var _super=_createSuper(MapController);function MapController(){_classCallCheck(this,MapController);return _super.apply(this,arguments)}_createClass(MapController,[{key:\"init\",value:function init(main){this.grid=[[blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Air,blocks_1.Blocks.Solid,blocks_1.Blocks.Air,blocks_1.Blocks.Solid],[blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid,blocks_1.Blocks.Solid]]}},{key:\"destroy\",value:function destroy(){this.grid=null}},{key:\"draw\",value:function draw(canvas){var cellWidth=this.getCellWidth(canvas.width);var cellHeight=this.getCellHeight(canvas.height);var context=canvas.context;for(var x=0;x<this.width;x++){for(var y=0;y<this.height;y++){var block=this.grid[y][x];var color=this.getColor(block);context.fillStyle=color.fill;context.strokeStyle=color.stroke;context.beginPath();context.rect(x*cellWidth,y*cellHeight,cellWidth,cellHeight);context.fill();context.stroke()}}}},{key:\"getColor\",value:function getColor(block){switch(block){case blocks_1.Blocks.Air:return{fill:\"#151D3B\",stroke:\"rgba(255, 255, 255, 0.15)\"};case blocks_1.Blocks.Solid:return{fill:\"#DADBBD\",stroke:\"rgba(0, 0, 0, 0.35)\"};}}},{key:\"getCellWidth\",value:function getCellWidth(canvasWidth){return canvasWidth/this.width}},{key:\"getCellHeight\",value:function getCellHeight(canvasHeight){return canvasHeight/this.height}},{key:\"getCellSize\",value:function getCellSize(canvas){return new vector2_1.Vector2(this.getCellWidth(canvas.width),this.getCellHeight(canvas.height))}},{key:\"get\",value:function get(x,y){if(x instanceof vector2_1.Vector2){y=x.y;x=x.x}if(x<0||x>=this.width||y<0||y>=this.height){return null}else{return this.grid[Math.floor(y)][Math.floor(x)]}}},{key:\"width\",get:function get(){return this.grid.length}},{key:\"height\",get:function get(){return this.grid[0].length}}]);return MapController}(base_controller_1.BaseController);exports.MapController=MapController;\n\n},{\"../enum/blocks\":5,\"./../model/vector2\":12,\"./base-controller\":1}],4:[function(require,module,exports){\n\"use strict\";function _typeof(obj){\"@babel/helpers - typeof\";return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&\"function\"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function\")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,\"prototype\",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)===\"object\"||typeof call===\"function\")){return call}else if(call!==void 0){throw new TypeError(\"Derived constructors may only return object or undefined\")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")}return self}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}Object.defineProperty(exports,\"__esModule\",{value:true});exports.PlayerController=void 0;var keys_1=require(\"./../enum/keys\");var input_1=require(\"./../util/input\");var vector2_1=require(\"./../model/vector2\");var base_controller_1=require(\"./base-controller\");var PlayerController=/*#__PURE__*/function(_base_controller_1$Ba){_inherits(PlayerController,_base_controller_1$Ba);var _super=_createSuper(PlayerController);function PlayerController(){var _this;_classCallCheck(this,PlayerController);_this=_super.apply(this,arguments);_this.position=vector2_1.Vector2.zero();_this.sprintSpeedMultiplier=2.5;_this.movementSpeed=5;_this.angularVelocity=2.5;_this.angle=0;return _this}_createClass(PlayerController,[{key:\"init\",value:function init(main){this.position=new vector2_1.Vector2(main.map.width/2,main.map.height/2);this.angle=-Math.PI/2}},{key:\"destroy\",value:function destroy(){}},{key:\"update\",value:function update(main){var velocityMultiplier=input_1.Input.isKeyDown(keys_1.Keys.SHIFT)?this.sprintSpeedMultiplier:1;var velocity=this.movementSpeed*velocityMultiplier;var angularVelocity=this.angularVelocity*velocityMultiplier;var deltaTime=main.frame.deltaTime;if(input_1.Input.mouseAxis.x!=0){this.angle=Math.clampAngle(this.angle+input_1.Input.mouseAxis.x*(angularVelocity/4)*deltaTime)}if(input_1.Input.isKeyDown(keys_1.Keys.A)){this.position.x+=Math.cos(this.angle-Math.PI/2)*velocity*deltaTime;this.position.y+=Math.sin(this.angle-Math.PI/2)*velocity*deltaTime}if(input_1.Input.isKeyDown(keys_1.Keys.ARROW_LEFT)){this.angle-=angularVelocity*deltaTime;if(this.angle<0)this.angle+=Math.PI*2}if(input_1.Input.isKeyDown(keys_1.Keys.D)){this.position.x-=Math.cos(this.angle-Math.PI/2)*velocity*deltaTime;this.position.y-=Math.sin(this.angle-Math.PI/2)*velocity*deltaTime}if(input_1.Input.isKeyDown(keys_1.Keys.ARROW_RIGHT)){this.angle+=angularVelocity*deltaTime;if(this.angle>=Math.PI*2)this.angle-=Math.PI*2}if(input_1.Input.isKeyDown(keys_1.Keys.ARROW_UP)||input_1.Input.isKeyDown(keys_1.Keys.W)){this.position.x+=velocity*Math.cos(this.angle)*deltaTime;this.position.y+=velocity*Math.sin(this.angle)*deltaTime}if(input_1.Input.isKeyDown(keys_1.Keys.ARROW_DOWN)||input_1.Input.isKeyDown(keys_1.Keys.S)){this.position.x-=velocity*Math.cos(this.angle)*deltaTime;this.position.y-=velocity*Math.sin(this.angle)*deltaTime}}},{key:\"render\",value:function render(canvas){}},{key:\"renderMinimap\",value:function renderMinimap(main){var canvas=main.minimapCanvas;var context=canvas.context;var x=this.position.x/main.map.width*canvas.width;var y=this.position.y/main.map.height*canvas.height;context.fillStyle=\"#FF0000\";context.beginPath();context.arc(x,y,5,0,Math.PI*2);context.fill()}}]);return PlayerController}(base_controller_1.BaseController);exports.PlayerController=PlayerController;\n\n},{\"./../enum/keys\":6,\"./../model/vector2\":12,\"./../util/input\":14,\"./base-controller\":1}],5:[function(require,module,exports){\n\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});exports.Blocks=void 0;var Blocks;(function(Blocks){Blocks[Blocks[\"Air\"]=0]=\"Air\";Blocks[Blocks[\"Solid\"]=1]=\"Solid\"})(Blocks=exports.Blocks||(exports.Blocks={}));\n\n},{}],6:[function(require,module,exports){\n\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});exports.Keys=void 0;var Keys;(function(Keys){Keys[\"ARROW_UP\"]=\"ArrowUp\";Keys[\"ARROW_DOWN\"]=\"ArrowDown\";Keys[\"ARROW_LEFT\"]=\"ArrowLeft\";Keys[\"ARROW_RIGHT\"]=\"ArrowRight\";Keys[\"SHIFT\"]=\"Shift\";Keys[\"W\"]=\"KeyW\";Keys[\"A\"]=\"KeyA\";Keys[\"S\"]=\"KeyS\";Keys[\"D\"]=\"KeyD\"})(Keys=exports.Keys||(exports.Keys={}));;\n\n},{}],7:[function(require,module,exports){\n\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});require(\"./window\");CanvasRenderingContext2D.prototype.drawLine=function(from,to,color){this.beginPath();this.moveTo(from.x,from.y);this.lineTo(to.x,to.y);this.strokeStyle=color;this.stroke();this.closePath()};CanvasRenderingContext2D.prototype.drawRect=function(position,size,color){this.beginPath();this.fillStyle=color;this.fillRect(position.x,position.y,size.x,size.y);this.stroke()};CanvasRenderingContext2D.prototype.drawCircle=function(position,radius,color){this.beginPath();this.fillStyle=color;this.arc(position.x,position.y,radius,0,2*Math.PI);this.fill()};CanvasRenderingContext2D.prototype.drawText=function(text,position,color){this.fillStyle=color;this.fillText(text,position.x,position.y)};\n\n},{\"./window\":9}],8:[function(require,module,exports){\n\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});require(\"./window\");Math.clamp=function(value,min,max){return Math.max(min,Math.min(value,max))};Math.clampAngle=function(value){if(value<0){return value+Math.PI*2}else if(value>Math.PI*2){return value-Math.PI*2}else{return value}};Number.prototype.toRadians=function(){return this*Math.PI/180};Number.prototype.toDegrees=function(){return this*180/Math.PI};\n\n},{\"./window\":9}],9:[function(require,module,exports){\n\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});\n\n},{}],10:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.Main=void 0;var ray_hit_1=require(\"./model/ray-hit\");var color_1=require(\"./util/color\");var vector2_1=require(\"./model/vector2\");var frame_1=require(\"./controller/frame\");var player_1=require(\"./controller/player\");var map_1=require(\"./controller/map\");require(\"./extension/window\");require(\"./extension/canvas\");require(\"./extension/math\");var input_1=require(\"./util/input\");var density_canvas_1=require(\"./widget/density-canvas\");var blocks_1=require(\"./enum/blocks\");var RAY_MAX_DISTANCE=10;var Main=/*#__PURE__*/function(){function Main(){_classCallCheck(this,Main);this.map=new map_1.MapController;this.player=new player_1.PlayerController;this.frame=new frame_1.FrameController;this.needToRender=true;this.fov=60;this.map.init(this);this.player.init(this);input_1.Input.init();this.setupWindow();requestAnimationFrame(this.onUpdate.bind(this))}_createClass(Main,[{key:\"setupWindow\",value:function setupWindow(){this.setupCanvas();this.setupMinimap();this.onDocumentSizeChanged();window.addEventListener(\"resize\",this.onDocumentSizeChanged.bind(this));window.addEventListener(\"beforeunload\",this.onDestroy.bind(this))}},{key:\"setupCanvas\",value:function setupCanvas(){this.canvas=new density_canvas_1.DensityCanvas(\"main\");this.canvas.attachToElement(document.body)}},{key:\"setupMinimap\",value:function setupMinimap(){this.minimapCanvas=new density_canvas_1.DensityCanvas(\"minimap\");this.minimapCanvas.attachToElement(document.body)}},{key:\"onDocumentSizeChanged\",value:function onDocumentSizeChanged(){var body=document.body;this.canvas.setSize(body.clientWidth,body.clientHeight);var size=Math.min(body.clientWidth,body.clientHeight)*0.25;this.minimapCanvas.setSize(size,size);this.fov=Math.clampAngle(Math.clamp(this.canvas.width*65/1920,55,70).toRadians())}},{key:\"onDestroy\",value:function onDestroy(){input_1.Input.destroy();this.map.destroy()}},{key:\"onUpdate\",value:function onUpdate(){this.frame.startFrame();this.player.update(this);this.onRender();input_1.Input.resetAxis();this.frame.endFrame(this.onUpdate.bind(this))}},{key:\"drawRayMinimap\",value:function drawRayMinimap(hit,cell){this.minimapCanvas.context.drawLine(vector2_1.Vector2.multiply(this.player.position,cell),vector2_1.Vector2.multiply(hit.position,cell),\"pink\")}},{key:\"drawRayWall\",value:function drawRayWall(hit,rayCount,index){var maxDistance=Math.PI*2;var wallPadding=1;var wallHeight=this.canvas.height/2/hit.distance;var wallWidth=this.canvas.width/rayCount;var context=this.canvas.context;var x=index*wallWidth-wallPadding/2;var shade=Math.clamp(Math.clamp(hit.distance,0,maxDistance)/maxDistance,0.15,1)*80+(hit.isHorizontal?10:0);context.fillStyle=color_1.Color.darken(\"#ff4757\",shade);context.fillRect(x,this.canvas.height/2-wallHeight/2-1,wallWidth+wallPadding,wallHeight+2)}},{key:\"compensateFishEye\",value:function compensateFishEye(rayAngle,hit){var angleDiff=Math.clampAngle(this.player.angle-rayAngle);hit.distance*=Math.cos(angleDiff)}},{key:\"drawCeilingAndFloor\",value:function drawCeilingAndFloor(){var context=this.canvas.context;context.fillStyle=\"#57606f\";context.fillRect(0,0,this.canvas.width,this.canvas.height/2);context.fillStyle=\"#2f3542\";context.fillRect(0,this.canvas.height/2,this.canvas.width,this.canvas.height/2)}},{key:\"castRay\",value:function castRay(angle){var from=this.player.position.clone();var direction=new vector2_1.Vector2(Math.cos(angle),Math.sin(angle)).normalize();var unitStepSize=new vector2_1.Vector2(Math.abs(1/direction.x),Math.abs(1/direction.y));var current=new vector2_1.Vector2(Math.floor(from.x),Math.floor(from.y));var step=new vector2_1.Vector2(Math.sign(direction.x),Math.sign(direction.y));var length=new vector2_1.Vector2(direction.x<0?(from.x-current.x)*unitStepSize.x:(current.x+1-from.x)*unitStepSize.x,direction.y<0?(from.y-current.y)*unitStepSize.y:(current.y+1-from.y)*unitStepSize.y);var distance=0;var found=false;var isHorizontal=false;while(!found&&distance<RAY_MAX_DISTANCE){if(length.x<length.y){current.x+=step.x;distance=length.x;length.x+=unitStepSize.x;isHorizontal=true}else{current.y+=step.y;distance=length.y;length.y+=unitStepSize.y;isHorizontal=false}var block=this.map.get(current.x,current.y);if(block!=blocks_1.Blocks.Air)found=true}if(found){return new ray_hit_1.RayHit(new vector2_1.Vector2(from.x+direction.x*distance,from.y+direction.y*distance),distance,isHorizontal,!isHorizontal)}return null}},{key:\"castRays\",value:function castRays(){var fovRadians=this.fov;var rayCount=this.canvas.width/2;var rayGap=fovRadians/rayCount;var cellSize=this.map.getCellSize(this.minimapCanvas);var rayAngle=this.player.angle-fovRadians/2;for(var i=0;i<rayCount;i++){var hit=this.castRay(rayAngle);if(hit){this.drawRayMinimap(hit,cellSize);this.compensateFishEye(rayAngle,hit);this.drawRayWall(hit,rayCount,i)}rayAngle=Math.clampAngle(rayAngle+rayGap)}}},{key:\"onRender\",value:function onRender(){this.minimapCanvas.clear();this.map.draw(this.minimapCanvas);this.player.renderMinimap(this);this.canvas.clear();this.drawCeilingAndFloor();this.castRays();this.frame.renderFPSCounter(this.canvas)}}]);return Main}();exports.Main=Main;window.main=new Main;\n\n},{\"./controller/frame\":2,\"./controller/map\":3,\"./controller/player\":4,\"./enum/blocks\":5,\"./extension/canvas\":7,\"./extension/math\":8,\"./extension/window\":9,\"./model/ray-hit\":11,\"./model/vector2\":12,\"./util/color\":13,\"./util/input\":14,\"./widget/density-canvas\":15}],11:[function(require,module,exports){\n\"use strict\";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}Object.defineProperty(exports,\"__esModule\",{value:true});exports.RayHit=void 0;var RayHit=/*#__PURE__*/_createClass(function RayHit(position,distance,isHorizontal,isVertical){_classCallCheck(this,RayHit);this.position=position;this.distance=distance;this.isHorizontal=isHorizontal;this.isVertical=isVertical});exports.RayHit=RayHit;\n\n},{}],12:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.Vector2=void 0;var Vector2=/*#__PURE__*/function(){function Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);this.x=0;this.y=0;this.x=x;this.y=y}_createClass(Vector2,[{key:\"add\",value:function add(b){this.x+=b.x;this.y+=b.y}},{key:\"subtract\",value:function subtract(b){this.x-=b.x;this.y-=b.y}},{key:\"multiply\",value:function multiply(b){this.x*=b.x;this.y*=b.y}},{key:\"divide\",value:function divide(b){this.x/=b.x;this.y/=b.y}},{key:\"distanceSquared\",value:function distanceSquared(b){return Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2)}},{key:\"distance\",value:function distance(b){return Math.sqrt(this.distanceSquared(b))}},{key:\"equals\",value:function equals(b){return this.x===b.x&&this.y===b.y}},{key:\"dot\",value:function dot(b){return this.x*b.x+this.y*b.y}},{key:\"cross\",value:function cross(b){return this.x*b.y-this.y*b.x}},{key:\"length\",value:function length(){return Math.sqrt(this.lengthSquared())}},{key:\"lengthSquared\",value:function lengthSquared(){return this.x*this.x+this.y*this.y}},{key:\"normalize\",value:function normalize(){var length=this.length();return new Vector2(this.x/length,this.y/length)}},{key:\"clone\",value:function clone(){return new Vector2(this.x,this.y)}},{key:\"toString\",value:function toString(){return\"(\".concat(this.x,\", \").concat(this.y,\")\")}}],[{key:\"add\",value:function add(a,b){return new Vector2(a.x+b.x,a.y+b.y)}},{key:\"subtract\",value:function subtract(a,b){return new Vector2(a.x-b.x,a.y-b.y)}},{key:\"multiply\",value:function multiply(a,b){return new Vector2(a.x*b.x,a.y*b.y)}},{key:\"divide\",value:function divide(a,b){return new Vector2(a.x/b.x,a.y/b.y)}},{key:\"zero\",value:function zero(){return new Vector2(0,0)}},{key:\"one\",value:function one(){return new Vector2(1,1)}},{key:\"up\",value:function up(){return new Vector2(0,-1)}},{key:\"down\",value:function down(){return new Vector2(0,1)}},{key:\"left\",value:function left(){return new Vector2(-1,0)}},{key:\"right\",value:function right(){return new Vector2(1,0)}}]);return Vector2}();exports.Vector2=Vector2;\n\n},{}],13:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.Color=void 0;var Color=/*#__PURE__*/function(){function Color(){_classCallCheck(this,Color)}_createClass(Color,null,[{key:\"darken\",value:function darken(color,amount){var R=parseInt(color.substring(1,3),16);var G=parseInt(color.substring(3,5),16);var B=parseInt(color.substring(5,7),16);R=Math.floor(R*(100-amount)/100);G=Math.floor(G*(100-amount)/100);B=Math.floor(B*(100-amount)/100);R=R<255?R:255;G=G<255?G:255;B=B<255?B:255;var RR=R.toString(16).length==1?\"0\"+R.toString(16):R.toString(16);var GG=G.toString(16).length==1?\"0\"+G.toString(16):G.toString(16);var BB=B.toString(16).length==1?\"0\"+B.toString(16):B.toString(16);return\"#\"+RR+GG+BB}}]);return Color}();exports.Color=Color;\n\n},{}],14:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.Input=void 0;var vector2_1=require(\"./../model/vector2\");var keys_1=require(\"./../enum/keys\");var Input=/*#__PURE__*/function(){function Input(){_classCallCheck(this,Input)}_createClass(Input,null,[{key:\"init\",value:function init(){window.addEventListener(\"keyup\",this.onKey.bind(this));window.addEventListener(\"keydown\",this.onKey.bind(this));window.addEventListener(\"pointerdown\",this.onMouseMove.bind(this));window.addEventListener(\"pointermove\",this.onMouseMove.bind(this));window.addEventListener(\"pointerup\",this.onMouseUp.bind(this))}},{key:\"destroy\",value:function destroy(){window.removeEventListener(\"keyup\",this.onKey.bind(this));window.removeEventListener(\"keydown\",this.onKey.bind(this))}},{key:\"onKey\",value:function onKey(event){var code=event.code;if(event.key==\"Shift\"||event.key==\"Control\"||event.key==\"Alt\")code=event.key;var cached=this.eventBuffer.find(function(x){return x.code===code});if(cached){if(cached.type===event.type){return}else{cached.type=event.type}}else{this.eventBuffer.push({type:event.type,code:code})}var keyCodeIndex=this.consumedKeyCodes.indexOf(code);if(keyCodeIndex===-1)return;var pressedKeysIndex=this.pressedKeys.indexOf(code);if(event.type==\"keyup\"){if(pressedKeysIndex!==-1){this.pressedKeys.splice(pressedKeysIndex,1)}}else if(pressedKeysIndex===-1){this.pressedKeys.push(code)}}},{key:\"isKeyDown\",value:function isKeyDown(key){return this.pressedKeys.indexOf(key)!==-1}},{key:\"isAnyKeyDown\",value:function isAnyKeyDown(){return this.pressedKeys.length>0}},{key:\"resetKey\",value:function resetKey(key){var index=this.pressedKeys.indexOf(key);if(index!==-1)this.pressedKeys.splice(index,1)}},{key:\"resetAllKeys\",value:function resetAllKeys(){this.pressedKeys=[]}},{key:\"onMouseMove\",value:function onMouseMove(event){if(!this.mouseDownTime)this.mouseDownTime=Date.now();this.isTouchDevice=event.pointerType===\"touch\";var position=new vector2_1.Vector2(event.clientX,event.clientY);var difference=null;if(this.isTouchDevice){difference=vector2_1.Vector2.subtract(Input.mouse,position)}else{difference=vector2_1.Vector2.subtract(position,Input.mouse)}this.mouseAxis=difference;this.mouse=position}},{key:\"onMouseUp\",value:function onMouseUp(event){var elapsed=Date.now()-this.mouseDownTime;if(this.isTouchDevice&&elapsed<=80){this.mouseAxis=vector2_1.Vector2.zero()}this.mouseDownTime=null}},{key:\"resetAxis\",value:function resetAxis(){if(this.isTouchDevice){this.mouseAxis.x*=0.95;this.mouseAxis.y*=0.95}else{this.mouseAxis=vector2_1.Vector2.zero()}}}]);return Input}();exports.Input=Input;Input.consumedKeyCodes=Object.values(keys_1.Keys);Input.pressedKeys=[];Input.eventBuffer=[];Input.mouse=vector2_1.Vector2.zero();Input.mouseAxis=vector2_1.Vector2.zero();Input.isTouchDevice=false;Input.mouseDownTime=null;\n\n},{\"./../enum/keys\":6,\"./../model/vector2\":12}],15:[function(require,module,exports){\n\"use strict\";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,\"prototype\",{writable:false});return Constructor}Object.defineProperty(exports,\"__esModule\",{value:true});exports.DensityCanvas=void 0;var DensityCanvas=/*#__PURE__*/function(){function DensityCanvas(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,DensityCanvas);this.canvas=document.createElement(\"canvas\");this.virtualWidth=null;this.virtualHeight=null;this.drawRatio=1;if(name){this.canvas.id=name}this.context.imageSmoothingEnabled=false;this.context[\"mozImageSmoothingEnabled\"]=false}_createClass(DensityCanvas,[{key:\"getBackingStoreRatio\",value:function getBackingStoreRatio(context){return context[\"webkitBackingStorePixelRatio\"]||context[\"mozBackingStorePixelRatio\"]||context[\"msBackingStorePixelRatio\"]||context[\"oBackingStorePixelRatio\"]||context[\"backingStorePixelRatio\"]||1}},{key:\"getDevicePixelRation\",value:function getDevicePixelRation(){return window.devicePixelRatio||1}},{key:\"getDrawRatio\",value:function getDrawRatio(backingStoreRatio,devicePixelRatio){return devicePixelRatio/backingStoreRatio}},{key:\"setSize\",value:function setSize(width,height){var backingStoreRatio=this.getBackingStoreRatio(this.context);var devicePixelRatio=this.getDevicePixelRation();this.drawRatio=this.getDrawRatio(backingStoreRatio,devicePixelRatio);if(backingStoreRatio!==devicePixelRatio){this.canvas.width=width*this.drawRatio;this.canvas.height=height*this.drawRatio;this.canvas.style.width=\"\".concat(width,\"px\");this.canvas.style.minWidth=\"\".concat(width,\"px\");this.canvas.style.height=\"\".concat(height,\"px\");this.canvas.style.minHeight=\"\".concat(height,\"px\")}else{this.canvas.width=width;this.canvas.height=height;this.canvas.style.width=\"\";this.canvas.style.height=\"\"}this.context.scale(this.drawRatio,this.drawRatio);this.virtualWidth=width;this.virtualHeight=height}},{key:\"clear\",value:function clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:\"drawTo\",value:function drawTo(x,y,foreignContext){foreignContext.save();foreignContext.scale(1/this.drawRatio,1/this.drawRatio);foreignContext.drawImage(this.canvas,x,y);foreignContext.restore()}},{key:\"attachToElement\",value:function attachToElement(element){element.appendChild(this.canvas)}},{key:\"width\",get:function get(){return this.virtualWidth||this.canvas.width}},{key:\"height\",get:function get(){return this.virtualHeight||this.canvas.height}},{key:\"context\",get:function get(){return this.canvas.getContext(\"2d\")}}]);return DensityCanvas}();exports.DensityCanvas=DensityCanvas;\n\n},{}]},{},[10]);\n"],"file":"bundle.js"}